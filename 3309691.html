<!DOCTYPE html>
<html>
    <head>
        <title>MegaFon - Telecom API : Мегафон.API : описание программных интерфейсов</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">MegaFon - Telecom API</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            MegaFon - Telecom API : Мегафон.API : описание программных интерфейсов
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Alexey Brykov</span>, last modified by <span class='editor'> Sergei Naumov</span> on Dec 07, 2018
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <div class="contentLayout2">
<div class="columnLayout single" data-layout="single">
<div class="cell normal" data-type="normal">
<div class="innerCell">
<p><br/></p><h1 id="id-Мегафон.API:описаниепрограммныхинтерфейсов-Общиесведения">Общие сведения </h1><p>Голосовая часть МегаФон.API представляет собой платформу, инкапсулирующую в себе все сложности и особенности сетей телекоммуникаций и предоставляющая внешнему разработчику возможность прямого &quot;манипулирования&quot; сетью связи с помощью максимально простых и понятных программных средств. Реализация представляет сбой обмен командами поверх WebSocket-интерфейса к платформе после необходимой стадии аутентификации и авторизации. Обмен внутри ws-трубы происходит в виде JSON-структур (форматируются в соответствии с спецификацией <a href="https://www.jsonrpc.org/" class="external-link" rel="nofollow">JSON-RPC 2.0</a>), содержащих команды и данные, необходимые для выполнения этих команд.</p><p>Приложения разработчика могут подписываться на те или иные события, происходящие в сети, например, нажатия на кнопки абонентом или совершение входящего вызова на тот или иной номер. В некоторых случаях приложение разработчика автоматически подписывается на те или иные события - логика работы сети связи требует уведомлять, например, на событие снятия трубки или нажатия на кнопки цифровой панели телефона.</p></div>
</div>
</div>
<div class="columnLayout single" data-layout="single">
<div class="cell normal" data-type="normal">
<div class="innerCell">
<h1 id="id-Мегафон.API:описаниепрограммныхинтерфейсов-Аутентификацияиавторизация">Аутентификация и авторизация</h1><p align="justify">Для аутентификации на платформе МегаФон.API используется действующий лицевой счет и номер телефона (API-подписка). Эта подписка является для разработчика, по-сути, лицензионным ключом, который, будучи использован в приложение разработчика, позволяет ему реализовывать телеком-функционал и встраивать его в свою сервисную логику. Тарификация трафика в сети оператора также происходит на лицевом счете API-подписки. С точки зрения своего жизненного цикла (подключение, пополнение баланса, услуги и т.п.) API-подписка является обычным телефонным номером (MSISDN) в сети оператора связи. Разработчик волен сам принимать решение о том, использует ли каждая копия разработанного им приложения отдельную API-подписку или все копии пользуются одной API-подпиской. Ответственность за проверку корректности API-подписки для приложений (не санкционированное использование, учет и т.п.) лежит на самом разработчике.</p><p>Для осуществления обмена сообщениями по протоколу WebSocket внешнее приложение должно включать заголовок “Authorization” во все запросы, указывая токен, полученный на стадии регистрации приложения. Токен создается для каждой API-подписки и является уникальным. Формат записи токена в HTTP-заголовке:</p><pre><br/>“Authorization”: “JWT {token}”</pre><p><br/></p><p>Если приложение по какой-либо причине не может добавлять HTTP-заголовки (например, на JavaScript изнутри браузера внутрь WebSocket'а), можно пользоваться Basic-авторизацией с использованием логина и пароля. </p></div>
</div>
</div>
<div class="columnLayout single" data-layout="single">
<div class="cell normal" data-type="normal">
<div class="innerCell">
<h1 id="id-Мегафон.API:описаниепрограммныхинтерфейсов-Команды">Команды</h1></div>
</div>
</div>
<div class="columnLayout single" data-layout="single">
<div class="cell normal" data-type="normal">
<div class="innerCell">
<h2 id="id-Мегафон.API:описаниепрограммныхинтерфейсов-Контрольисходящеговызова">Контроль исходящего вызова</h2><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/></colgroup><tbody><tr><td class="confluenceTd"><p class="TableContents">Имя</p></td><td class="confluenceTd"><p class="TableContents">Описание</p></td></tr><tr><td class="confluenceTd"><p class="Standard"><a href="3309756.html#id-Исходящийвызов-MakeCall">MakeCall</a></p></td><td class="confluenceTd"><p class="TableContents">Инициировать  исходящий вызов</p></td></tr><tr><td class="confluenceTd"><p class="Standard"><a href="3309756.html#id-Исходящийвызов-TerminateCall">TerminateCall</a></p></td><td class="confluenceTd"><p class="TableContents">Завершить вызов</p></td></tr></tbody></table></div><h2 id="id-Мегафон.API:описаниепрограммныхинтерфейсов-Контрольвходящеговызова"> Контроль входящего вызова</h2><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/></colgroup><tbody><tr><td class="confluenceTd"><p class="TableContents">Имя</p></td><td class="confluenceTd"><p class="TableContents">Описание</p></td></tr><tr><td class="confluenceTd"><p class="Standard"><a href="4718670.html#id-Входящийвызов-ОбработкасобытияOnIncomingCall">&lt;IncomingCall&gt;</a></p></td><td class="confluenceTd"><p class="TableContents">Прием события OnIncomingCall</p></td></tr><tr><td class="confluenceTd"><p class="Standard"><a href="4718670.html#id-Входящийвызов-TerminateCall">TerminateCall</a></p></td><td class="confluenceTd"><p class="TableContents">Завершить вызов</p></td></tr><tr><td class="confluenceTd"><p class="Standard"><a href="4718670.html#id-Входящийвызов-AnswerCall">AnswerCall</a></p></td><td class="confluenceTd"><p class="TableContents">Принять вызов</p></td></tr><tr><td colspan="1" class="confluenceTd"><a href="4718670.html">RejectCall</a></td><td colspan="1" class="confluenceTd">Отбить вызов</td></tr></tbody></table></div><h2 id="id-Мегафон.API:описаниепрограммныхинтерфейсов-Обработкавызовапослесоединения"> Обработка вызова после соединения</h2><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/></colgroup><tbody><tr><td class="confluenceTd"><p class="TableContents">Имя</p></td><td class="confluenceTd"><p class="TableContents">Описание</p></td></tr><tr><td colspan="1" class="confluenceTd"><a href="4718672.html#id-Обработкавызовапослесоединения-TromboneCall">TromboneCall</a></td><td colspan="1" class="confluenceTd">Соединить две голосовых сессии между собой</td></tr><tr><td class="confluenceTd"><p class="Standard"><a href="4718672.html#id-Обработкавызовапослесоединения-TerminateCall">TerminateCall</a></p></td><td class="confluenceTd"><p class="TableContents">Завершить вызов</p></td></tr><tr><td class="confluenceTd"><p class="Standard"><a href="4718672.html#id-Обработкавызовапослесоединения-PlayAnnouncement">PlayAnnouncement</a></p></td><td class="confluenceTd"><p class="TableContents">Проиграть звуковое сообщение на входящее или исходящее плечо вызова</p></td></tr><tr><td colspan="1" class="confluenceTd"><a href="4718672.html">RecordCall</a></td><td colspan="1" class="confluenceTd">Начать запись разговора</td></tr></tbody></table></div><h2 id="id-Мегафон.API:описаниепрограммныхинтерфейсов-Работасконференциями"> Работа с конференциями</h2><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/></colgroup><tbody><tr><td class="confluenceTd"><p class="Standard"><a href="3309759.html#id-Работасконференциями-CreateConf">CreateConf</a></p></td><td class="confluenceTd"><p class="TableContents">Создать конференцию</p></td></tr><tr><td class="confluenceTd"><p class="Standard"><a href="3309759.html#id-Работасконференциями-AddToConf">AddToConf</a></p></td><td class="confluenceTd"><p class="TableContents">Добавить существующий вызов в конференцию</p></td></tr><tr><td class="confluenceTd"><p class="Standard"><a href="3309759.html#id-Работасконференциями-RemoveFromConf">RemoveFromConf</a></p></td><td class="confluenceTd"><p class="TableContents">Удалить вызов из конференции</p></td></tr><tr><td class="confluenceTd"><p class="Standard"><a href="3309759.html#id-Работасконференциями-UpdateConf">UpdateConf</a></p></td><td class="confluenceTd"><p class="TableContents">Обновить параметры конференции</p></td></tr><tr><td class="confluenceTd"><p class="Standard"><a href="3309759.html#id-Работасконференциями-DeleteConf">DeleteConf</a></p></td><td class="confluenceTd"><p class="TableContents">Удалить конференцию</p></td></tr><tr><td colspan="1" class="confluenceTd"><a href="3309759.html">RecordConf</a></td><td colspan="1" class="confluenceTd">Начать запись конференции</td></tr></tbody></table></div><h2 id="id-Мегафон.API:описаниепрограммныхинтерфейсов-Работасочередями(вразработке)">Работа с очередями (в разработке)</h2><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/></colgroup><tbody><tr><td class="confluenceTd"><p class="Standard">CreateQueue</p></td><td class="confluenceTd"><p class="TableContents">Создать очередь вызовов</p></td></tr><tr><td class="confluenceTd"><p class="Standard">AddAgent</p></td><td class="confluenceTd"><p class="TableContents">Добавить к очереди агента (вызов на агента)</p></td></tr><tr><td class="confluenceTd"><p class="Standard">RemoveAgent</p></td><td class="confluenceTd"><p class="TableContents">Удалить агента (вызов на агента)</p></td></tr><tr><td class="confluenceTd"><p class="Standard">UpdateAgent</p></td><td class="confluenceTd"><p class="TableContents">Обновить данные по вызову на агента</p></td></tr><tr><td class="confluenceTd"><p class="Standard">PutOnQueue</p></td><td class="confluenceTd"><p class="TableContents">Поставить вызов в очередь</p></td></tr><tr><td class="confluenceTd"><p class="Standard">DeleteFromQueue</p></td><td class="confluenceTd"><p class="TableContents">Удалить вызов из очереди</p></td></tr><tr><td class="confluenceTd"><p class="Standard">DeleteQueue</p></td><td class="confluenceTd"><p class="TableContents">Удалить очередь</p></td></tr></tbody></table></div><h2 id="id-Мегафон.API:описаниепрограммныхинтерфейсов-Работассообщениями(вразработке)">Работа с сообщениями (в разработке)</h2><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/></colgroup><tbody><tr><td class="confluenceTd"><p class="Standard">SendSMS</p></td><td class="confluenceTd"><p class="TableContents">Отправить SMS</p></td></tr></tbody></table></div></div>
</div>
</div>
<div class="columnLayout single" data-layout="single">
<div class="cell normal" data-type="normal">
<div class="innerCell">
<h2 id="id-Мегафон.API:описаниепрограммныхинтерфейсов-События"><a href="3309767.html">События</a></h2></div>
</div>
</div>
<div class="columnLayout single" data-layout="single">
<div class="cell normal" data-type="normal">
<div class="innerCell">
<div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="width: 63.208954%;"><colgroup><col style="width: 15.287012%;"/><col style="width: 7.919622%;"/><col style="width: 76.79521%;"/></colgroup><tbody><tr><td class="confluenceTd"><p class="TableContents">Имя</p></td><td class="confluenceTd"><p class="TableContents">Исх/Вх</p></td><td class="confluenceTd"><p class="TableContents">Описание</p></td></tr><tr><td class="confluenceTd"><p class="Standard"><a href="3309767.html">OnIncomingCall</a></p></td><td class="confluenceTd"><p class="TableContents">В</p></td><td class="confluenceTd"><p class="TableContents">Событие отправляется по приходу входящего вызова на зарегистрированную API-подписку</p></td></tr><tr><td colspan="1" class="confluenceTd"><a href="3309767.html">OnTerminateCall</a></td><td colspan="1" class="confluenceTd">И+В</td><td colspan="1" class="confluenceTd">Событие отправляется по завершению вызова</td></tr><tr><td class="confluenceTd"><p class="Standard">OnAnswer</p></td><td class="confluenceTd"><p class="TableContents">И</p></td><td class="confluenceTd"><p class="TableContents">Событие отправляется после получения 200-ОК от абонента (в разработке)</p></td></tr><tr><td class="confluenceTd"><p class="Standard">OnNoAnswer</p></td><td class="confluenceTd"><p class="TableContents">И</p></td><td class="confluenceTd"><p class="TableContents">Событие отправляется после получения кода ошибки, отличного от 200 ОK (в разработке)</p></td></tr><tr><td class="confluenceTd"><p class="Standard">OnSpeech</p></td><td class="confluenceTd"><p class="TableContents">И+В</p></td><td class="confluenceTd"><p class="TableContents">Событие отправляется после определения голоса абонента (в разработке)</p></td></tr><tr><td class="confluenceTd"><p class="Standard">OnSilence</p></td><td class="confluenceTd"><p class="TableContents">И+В</p></td><td class="confluenceTd"><p class="TableContents">Событие отправляется после определения отсутствия голоса (в разработке)</p></td></tr><tr><td class="confluenceTd"><p class="Standard">OnQueue</p></td><td class="confluenceTd"><p class="TableContents">В</p></td><td class="confluenceTd"><p class="TableContents">Событие отправляется после постановки вызова в очередь (в разработке)</p></td></tr><tr><td class="confluenceTd"><p class="Standard">OnDequeue</p></td><td class="confluenceTd"><p class="TableContents">В</p></td><td class="confluenceTd"><p class="TableContents">Событие отправляется после начала обслуживания вызова (в разработке)</p></td></tr><tr><td class="confluenceTd"><p class="Standard">OnQueueUpdate</p></td><td class="confluenceTd"><p class="TableContents">В</p></td><td class="confluenceTd"><p class="TableContents">Событие отправляется при изменении состояния очереди (в разработке)</p></td></tr></tbody></table></div></div>
</div>
</div>
</div>
                    </div>

                    
                                                        <div class="pageSection group">
                        <div class="pageSectionHeader">
                            <h2 id="comments" class="pageSectionTitle">Comments:</h2>
                        </div>

                        <table border="0" width="100%">
                                                        <tr>
                                <td >
                                    <a name="comment-3309694"></a>
                                    <font class="smallfont"><p>общий порядок работы:</p><ol><li>описание дерется с <a href="https://www.twilio.com/docs/voice/api" class="external-link" rel="nofollow">https://www.twilio.com/docs/voice/api</a> по разделам</li><li>дерем раздел, корректируем под нашу реальность. реальность тут Общая папка\Проекты\Мегафон\MегаФон.API\Командный процессор id-MF01003. Megafon.API HLD v0.7.docx</li><li>формируем блоки которые готовы (а вдруг) и которые должны быть написаны</li><li>ищем по всем источникам информацию для блоков, собираем ее в них.</li><li>общий принцип создания блоков: <ol><li>ресурс- методы</li><li>группа задач - задача - примеры</li></ol></li></ol><p><br/></p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/contenttypes/comment_16.png" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by alexey.brykov at Nov 08, 2018 11:39
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-4718631"></a>
                                    <font class="smallfont"><p>наиболее полная исодная внрсия текста - в гуглопапке проекта, HLD м 07.5 KL</p><p><br/></p><p><br/></p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/contenttypes/comment_16.png" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by konstantin.levchin at Nov 12, 2018 15:51
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-4718735"></a>
                                    <font class="smallfont"><p>9:40<br/>пожалуй вся версия 7.6 с некоторыми мелкими уточнениями разложена в конфлюенс. По моему не хватает UpdateCall где можно было бы мутить дифить и рекордить</p><p>в конфе есть а в колле нету<br/>у нас пустые: СМС, очереди, ашыпки</p><p>для экспорта в хтмл: <a href="https://wiki.media-tel.ru/pages/viewpage.action?pageId=3309681" rel="nofollow">https://wiki.media-tel.ru/pages/viewpage.action?pageId=3309681</a><br/>в левом нижнем углу инструменты для пространства<br/>инструменты контента<br/>экспорт<br/>html<br/>пользовательский<br/>включить только Мегафон.API</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/contenttypes/comment_16.png" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by alexey.brykov at Nov 13, 2018 09:50
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-4718736"></a>
                                    <font class="smallfont"><p>Кстати эту вики можно и наружу высунуть</p><p><br/></p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/contenttypes/comment_16.png" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by alexey.brykov at Nov 13, 2018 09:53
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-4718770"></a>
                                    <font class="smallfont"><p>Кстати, вижу, что документация twilio реально сделана в slate... <img class="emoticon emoticon-smile" src="images/icons/emoticons/smile.svg" data-emoticon-name="smile" alt="(smile)"/></p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/contenttypes/comment_16.png" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by sergey.naumov at Nov 13, 2018 16:29
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-4718865"></a>
                                    <font class="smallfont"><p>Убрал красное, чтобы не попало в релиз. НЕ ЗАБЫТЬ Общие сведения и аторизацию - дописать</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/contenttypes/comment_16.png" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by konstantin.levchin at Nov 15, 2018 09:16
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-5701633"></a>
                                    <font class="smallfont"><p>Я вот тут попробовал экспортить из &quot;конфлюенса&quot; в html с помощью &quot;инструменты контента&quot;... Не нашел нигде никаких регулировок, что и как именно выгружать, а по умолчанию она выгружает все, включая комментарии к каждому разделу (например, тот, который я сейчас пишу). Все это как-то криво выходит. Есть соображения, как это сделать правильно, чтобы можно было наложить стили какие-то?</p><p><br/></p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/contenttypes/comment_16.png" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by sergey.naumov at Nov 19, 2018 10:19
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-5701637"></a>
                                    <font class="smallfont"><p>Там (<a href="https://confluence.atlassian.com/doc/export-content-to-word-pdf-html-and-xml-139475.html" class="external-link" rel="nofollow">https://confluence.atlassian.com/doc/export-content-to-word-pdf-html-and-xml-139475.html),</a> что надо поправить <code>confluence-x.y.z-jar/com/atlassian/confluence/pages/Page.htmlexport.vm</code></p><p>Поправьте, исключив экспорт комментариев.</p><p><br/></p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/contenttypes/comment_16.png" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by sergey.naumov at Nov 19, 2018 13:31
                                    </div>
                                </td>
                            </tr>
                                                    </table>
                    </div>
                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Dec 13, 2018 10:24</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
