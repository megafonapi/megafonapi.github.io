<!DOCTYPE html>
<html>
    <head>
        <title>MegaFon - Telecom API : Исходящий вызов</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">MegaFon - Telecom API</a></span>
                            </li>
                                                    <li>
                                <span><a href="3309691.html">Мегафон.API : описание программных интерфейсов</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            MegaFon - Telecom API : Исходящий вызов
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Alexey Brykov</span>, last modified by <span class='editor'> Sergei Naumov</span> on Dec 07, 2018
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <div class="contentLayout2">
<div class="columnLayout single" data-layout="single">
<div class="cell normal" data-type="normal">
<div class="innerCell">
<p><strong>Вызов</strong> представляет собой сценарий взаимодействия между приложением, телефонами и коммутатором через командный процессор.</p><p>По выполняемым задачам команды управления вызовами подразделяются на три группы, выполняемые в следующих случаях:</p><ul><li>Установление исходящего вызова (эта страница)</li><li><a href="4718670.html">Прием входящего вызова</a></li><li><a href="4718672.html">Обработка вызова и голосового тракта после того, как вызов установлен</a></li></ul><p>Все команды и ответы на них передаются по протоколу HTTP/WebSocket и синтаксически соответствуют спецификации <a href="https://www.jsonrpc.org/specification" class="external-link" rel="nofollow">JSON-RPC 2.0</a>.</p></div>
</div>
</div>
<div class="columnLayout single" data-layout="single">
<div class="cell normal" data-type="normal">
<div class="innerCell">
<h1 id="id-Исходящийвызов-MakeCall">MakeCall</h1><p>Инициирует установление вызова на телефонную сеть.</p><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/></colgroup><tbody><tr><th class="confluenceTh"><p>передаваемый</p><p>параметр</p></th><th class="confluenceTh">значение</th></tr><tr><td class="confluenceTd">anum</td><td class="confluenceTd">А – номер (номер вызывающего абонента) в формате E.164, например - “79281234567”. Данный номер соответствует номеру API-подписки, передаваемому при аутентификации разработчика для использования API (см. &quot;<a href="3309691.html#id-Мегафон.API:описаниепрограммныхинтерфейсов-Авторизация">Авторизация</a>&quot;). Не обязательный параметр, если в учетной записи разработчика только одна API-подписка, особенно удобно его не указывать при авторизации через токен.</td></tr><tr><td class="confluenceTd">bnum</td><td class="confluenceTd"><p>B – номер (номер вызываемого абонента) в формате E.164, например “79267654321”. В настоящее время допускаются следующие типы вызовов:</p></td></tr></tbody></table></div><p>В случае успешного соединения поле <strong>message</strong> устанавливается в значение <strong>Success</strong> и возвращаются следующие параметры</p><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/></colgroup><tbody><tr><th class="confluenceTh"><p>возвращаемый</p><p>параметр</p></th><th class="confluenceTh">значение</th></tr><tr><td class="confluenceTd">call_session</td><td class="confluenceTd">Уникальный идентификатор сеанса, используемый при дальнейшей работе с вызовом</td></tr></tbody></table></div><p>Необходимо помнить, что с помощью метода <code><a href="3309756.html">MakeCall</a><strong> </strong></code><strong>НЕЛЬЗЯ  </strong>установить соединение между <strong>ПРОИЗВОЛЬНЫМИ</strong> <code>anum</code> и <code>bnum</code>, поскольку первый <strong>НЕ МОЖЕТ</strong> быть любым - он, во избежание фальсификаций, может быть только из списка привязанных к учетной записи, под которой работает разработчик (номер API-подписки). Поэтому единичный вызов с помощью <code>MakeCall</code> можно представить как звонок &quot;из облака&quot; (а конкретнее, из приложения) на <code>bnum</code>.  В этом смысле API-подписку можно понимать как уникальный абонентский терминал, принадлежащий приложению разработчика. Для организации полноценного вызова между абонентами <code>bnum<sub>1 </sub>и bnum</code><sub><code>2</code> </sub>необходимо организовать две &quot;ноги&quot; - совершить два вызова <code>MakeCall </code>на номер<code> bnum<sub>1</sub>, на номер </code>bnum<sub>2</sub> и объединить их вместе (см. метод <a href="4718672.html"><code>TromboneCall</code></a>).</p><p><br/></p><h3 id="id-Исходящийвызов-События,ожидаемыеприложением(опционально)"><strong>События, ожидаемые приложением (опционально) </strong></h3><p>После вызова команды приложение автоматически подписано на следующие события  (см. <a href="3309767.html">Отслеживание и обработка событий</a>)</p><ul><li>OnTerminateCall</li><li>OnNoAnswer (в разработке)</li></ul><h3 id="id-Исходящийвызов-Синтаксисвызоваиответа"><strong style="letter-spacing: 0.0px;">Синтаксис вызова и ответа</strong></h3><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: jfx; gutter: false; theme: Eclipse" data-theme="Eclipse">{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;MakeCall&quot;,&quot;params&quot;:{&quot;anum&quot;:&quot;79281234567&quot;,&quot;bnum&quot;:&quot;79269876543&quot;},&quot;id&quot;:1}
{&quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;result&quot;: {&quot;message&quot;: &quot;Success&quot;, &quot;data&quot;: {&quot;call_session&quot;: &quot;1000272&quot;}}, &quot;id&quot;: 1}

{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;MakeCall&quot;,&quot;params&quot;:{&quot;anum&quot;:&quot;79281234567&quot;,&quot;bnum&quot;:&quot;79269876543&quot;,&quot;record&quot;:true},&quot;id&quot;:1}
{&quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;error&quot;: {&quot;code&quot;: -32000, &quot;message&quot;: &quot;Error&quot;, &quot;data&quot;: {&quot;code&quot;: -32021, &quot;reason&quot;: &quot;Subscriber is busy&quot;}}, &quot;id&quot;: 1}

{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;MakeCall&quot;,&quot;params&quot;:{&quot;anum&quot;:&quot;79281234567&quot;,&quot;bnum&quot;:&quot;79269876543&quot;,&quot;record&quot;:true},&quot;id&quot;:1}
{&quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;error&quot;: {&quot;code&quot;: -32000, &quot;message&quot;: &quot;Error&quot;, &quot;data&quot;: {&quot;code&quot;: -32002, &quot;reason&quot;: &quot;subscriber is absent&quot;}}, &quot;id&quot;: 1}

{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;MakeCall&quot;,&quot;params&quot;:{&quot;anum&quot;:&quot;79281234567&quot;,&quot;bnum&quot;:&quot;79269876543&quot;,&quot;record&quot;:true},&quot;id&quot;:1}
{&quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;error&quot;: {&quot;code&quot;: -32000, &quot;message&quot;: &quot;Error&quot;, &quot;data&quot;: {&quot;code&quot;: -32003, &quot;reason&quot;: &quot;unkown error&quot;}}, &quot;id&quot;: 1}</pre>
</div></div><h3 id="id-Исходящийвызов-Кодыошибок"><strong>Коды ошибок </strong></h3><p>В случае не успешного выполнения поле <strong>message</strong> устанавлвиается в значение <strong>Error</strong> и возвращаются следующие параметры:</p><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/></colgroup><tbody><tr><th class="confluenceTh">ошибки выполнения</th><th class="confluenceTh">значение</th></tr><tr><td class="confluenceTd">code / reason</td><td class="confluenceTd"><ul><li>-32021 / Subscriber is busy, абонент занят</li><li>-32002 / Subscriber is absent, абонент не найден</li><li>-32003 / unknown error, не известная ошибка</li></ul></td></tr></tbody></table></div></div>
</div>
</div>
<div class="columnLayout single" data-layout="single">
<div class="cell normal" data-type="normal">
<div class="innerCell">
<h1 id="id-Исходящийвызов-TerminateCall">TerminateCall</h1><p>Метод осуществляет разрыв вызова по инициативе приложения. Команда приведет к прекращению вызова в случае, если вызов был активным, или вернет код ошибки в любом другом случае.</p><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/></colgroup><tbody><tr><th class="confluenceTh"><p>передаваемый</p><p>параметр</p></th><th class="confluenceTh">значение</th></tr><tr><td class="confluenceTd">call_session</td><td class="confluenceTd">идентификатор сеанса, полученный при вызове команды <a href="#id-Исходящийвызов-MakeCall">MakeCall</a></td></tr></tbody></table></div><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/></colgroup><tbody><tr><th class="confluenceTh"><p>возвращаемый</p><p>параметр</p></th><th class="confluenceTh">значение</th></tr><tr><td class="confluenceTd">не предусмотрено</td><td class="confluenceTd"><br/></td></tr></tbody></table></div><h3 id="id-Исходящийвызов-События,ожидаемыеприложением(опционально).1"><strong>События, ожидаемые приложением (опционально)</strong></h3><p>Не предусмотрено.</p><h3 id="id-Исходящийвызов-Синтаксисвызоваиответа.1"><strong>Синтаксис вызова и ответа</strong></h3><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: jfx; gutter: false; theme: Eclipse" data-theme="Eclipse">{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;TerminateCall&quot;,&quot;params&quot;:{&quot;call_session&quot;:&quot;1000277&quot;},&quot;id&quot;:2}
{&quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;result&quot;: {&quot;message&quot;: &quot;Success&quot;, &quot;data&quot;: {}}, &quot;id&quot;: 2}

{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;TerminateCall&quot;,&quot;params&quot;:{&quot;call_session&quot;:&quot;1000277&quot;},&quot;id&quot;:2}
{&quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;error&quot;: {&quot;code&quot;: -32000, &quot;message&quot;: &quot;Error&quot;, &quot;data&quot;: {&quot;code&quot;: -32008, &quot;reason&quot;: &quot;resource error&quot;}}, &quot;id&quot;: 2}

{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;TerminateCall&quot;,&quot;params&quot;:{&quot;call_session&quot;:&quot;1000277&quot;},&quot;id&quot;:2}
{&quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;error&quot;: {&quot;code&quot;: -32000, &quot;message&quot;: &quot;Error&quot;, &quot;data&quot;: {&quot;code&quot;: -32009, &quot;reason&quot;: &quot;unknown_error&quot;}}, &quot;id&quot;: 2</pre>
</div></div><h3 id="id-Исходящийвызов-Кодыошибок.1"><strong>Коды ошибок</strong></h3><p>В случае не успешного соединения поле message устанавлвиается в значение Error и возвращаются следующие параметры:<strong><br/></strong></p><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/></colgroup><tbody><tr><th class="confluenceTh">ошибки выполнения</th><th class="confluenceTh">значение</th></tr><tr><td class="confluenceTd">code / reason</td><td class="confluenceTd"><ul><li>-32008 / resource error</li><li>-32009 / unknown error</li></ul></td></tr></tbody></table></div></div>
</div>
</div>
</div>
                    </div>

                    
                 
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Dec 07, 2018 17:06</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
